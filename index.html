<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="src/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <title>Home Page</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <script
        src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>

</head>

<body>

    <div class="grid-container">

        <div class="box left-nav">

            <h1>Welcome Joe!</h1>

            <div class="left-nav-cont">
                <div class="left-nav-item" onclick="window.location.href='index.html'">
                    <i class="fas fa-home"></i>
                    <p>Home</p>
                </div>
                <div class="left-nav-item" onclick="window.location.href='Add_Expenses.html'">
                    <i class="fas fa-plus"></i>
                    <p>Add Expense</p>
                </div>
                <div class="left-nav-item" onclick="window.location.href='View_Expenses.html'">
                    <i class="fas fa-eye"></i>
                    <p>View Expense</p>
                </div>
                <div class="left-nav-item" onclick="window.location.href='Transactions.html'">
                    <i class="fas fa-exchange-alt"></i>
                    <p>Transactions</p>
                </div>

            </div>
        </div>


        <div class="box middle-1">

            <h2 class="centered-heading">Quick Actions</h2>

            <div class="grid-2x2">
                <div class="grid-item">
                    <p>New Expense</p>
                    <i class="fa-solid fa-plus"></i>
                </div>

                <div class="grid-item">
                    <p>Scan Bill</p>
                    <i class="fa-solid fa-barcode"></i>
                </div>

                <div class="grid-item">
                    <p>Overview</p>
                    <i class="fa-regular fa-eye"></i>
                </div>

                <div class="grid-item">
                    <p>Download Data</p>
                    <i class="fa-solid fa-download"></i>
                </div>

            </div>

        </div>




        <div class="box middle-2">
            <h3 class="small-heading">Recent Expenses</h3>
            <hr class="white-line">
            <div class="sheet">
                <div class="sheet-item"><b>Place</b></div>
                <div class="sheet-item"><b>Type</b></div>
                <div class="sheet-item"><b>Date</b></div>
                <div class="sheet-item"><b>Amount</b></div>
                <!-- <div class="sheet-item">Costco</div>
                <div class="sheet-item">Food</div>
                <div class="sheet-item">9/11/22</div>
                <div class="sheet-item">$130</div>
                <div class="sheet-item">Costco</div>
                <div class="sheet-item">Food</div>
                <div class="sheet-item">9/11/22</div>
                <div class="sheet-item">$130</div>
                <div class="sheet-item">Costco</div>
                <div class="sheet-item">Food</div>
                <div class="sheet-item">9/11/22</div>
                <div class="sheet-item">$130</div>
                <div class="sheet-item">Costco</div>
                <div class="sheet-item">Food</div>
                <div class="sheet-item">9/11/22</div>
                <div class="sheet-item">$130</div> -->


            </div>

        </div>


        <div class="box bottom-nav">

            <div class="nav-item">
                <p>Monthly Overview</p>
                <div class="nav-item-inside">
                    <canvas id="expensesChart"></canvas>

                </div>
            </div>
            <div class="nav-item">
                <p>Top Expenses</p>
                <div class="nav-item-inside">

                </div>
            </div>



        </div>





    </div>


    <script src="src/script.js" type="module"></script>


    <script type="module">
        import { openDatabase } from './src/db.js';

        async function DB_Read() {
            try {
                const db = await openDatabase();
                const transaction = db.transaction(['expenses'], 'readonly');
                const objectStore = transaction.objectStore('expenses');
                const request = objectStore.getAll();

                return new Promise((resolve, reject) => {
                    request.onsuccess = (event) => {
                        const expenses = event.target.result;
                        resolve(expenses);
                    };

                    request.onerror = (event) => {
                        reject(event.target.error);
                    };
                });
            } catch (error) {
                console.error('Error initializing database:', error);
                throw error;
            }
        }

        function updateDOM(expenses) {
            const sheet = document.querySelector('.sheet');

            expenses.forEach(expense => {
                const placeDiv = document.createElement('div');
                placeDiv.className = 'sheet-item';
                placeDiv.textContent = expense.place;

                const typeDiv = document.createElement('div');
                typeDiv.className = 'sheet-item';
                typeDiv.textContent = expense.category;

                const dateDiv = document.createElement('div');
                dateDiv.className = 'sheet-item';
                dateDiv.textContent = expense.date;

                const amountDiv = document.createElement('div');
                amountDiv.className = 'sheet-item';
                amountDiv.textContent = `$${expense.amount}`;

                sheet.appendChild(placeDiv);
                sheet.appendChild(typeDiv);
                sheet.appendChild(dateDiv);
                sheet.appendChild(amountDiv);
            });
        }

        function createChart(expenses) {
            const ctx = document.getElementById('expensesChart').getContext('2d');
            const dates = expenses.map(expense => new Date(expense.date));
            const amounts = expenses.map(expense => expense.amount);

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: '',
                        data: amounts,
                        borderColor: 'rgba(255, 99, 132, 1)',
                        pointBackgroundColor: 'rgba(255, 99, 132, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: '#fff',
                        fill: false,
                        tension: 0.1
                    }]
                },
                options: {
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            type: 'time',
                            time: {
                                unit: 'day'
                            },
                            ticks: {
                                color: '#fff',
                                stepSize: 1,
                                maxRotation: 45,
                                minRotation: 45,
                                align: 'start'
                            },
                            grid: {
                                color: '#fff',
                                borderColor: '#fff',
                                offset: false
                            },
                            border: {
                                color: '#fff'
                            }
                        },
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: '#fff',
                                stepSize: 100
                            },
                            grid: {
                                color: '#fff',
                                borderColor: '#fff',
                                offset: false
                            },
                            border: {
                                color: '#fff'
                            }
                        }
                    }
                }
            });
        }

        async function initialize() {
            try {
                const expenses = await DB_Read();
                updateDOM(expenses);
                createChart(expenses);
            } catch (error) {
                console.error('Error reading expenses from the database:', error);
            }
        }

        document.addEventListener('DOMContentLoaded', initialize);
    </script>
</body>

</html>